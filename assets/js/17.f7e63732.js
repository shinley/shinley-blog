(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{163:function(s,t,a){"use strict";a.r(t);var e=a(0),r=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"_18-小表驱动大表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_18-小表驱动大表","aria-hidden":"true"}},[s._v("#")]),s._v(" 18.小表驱动大表")]),s._v(" "),a("ul",[a("li",[s._v("查询优化")]),s._v(" "),a("li",[s._v("慢查询日志")]),s._v(" "),a("li",[s._v("指量数据脚本")]),s._v(" "),a("li",[s._v("Show Profile")]),s._v(" "),a("li",[s._v("全局查询日志")])]),s._v(" "),a("h2",{attrs:{id:"分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分析","aria-hidden":"true"}},[s._v("#")]),s._v(" 分析")]),s._v(" "),a("ul",[a("li",[s._v("1.观察，至少跑一天，看看生产环境的慢SQL情况。")]),s._v(" "),a("li",[s._v("2.开启慢查询日志，设置阈值，比如超过300毫秒的就是慢SQL,并将它抓取出来")]),s._v(" "),a("li",[s._v("3.explain+慢SQL分析")]),s._v(" "),a("li",[s._v("4.show profile")]),s._v(" "),a("li",[s._v("4.运维经理 or DBA 进行SQL数据库服务器的参数调优。")])]),s._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("ul",[a("li",[s._v("1.慢查询的开启并捕获")]),s._v(" "),a("li",[s._v("2.explain + 慢SQL分析")]),s._v(" "),a("li",[s._v("3.show profile查询的SQL在MySQL服务器里面的执行细节和生命周期情况")]),s._v(" "),a("li",[s._v("4.SQL数据库服务器的参数调优")])]),s._v(" "),a("h2",{attrs:{id:"exists-和-in"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#exists-和-in","aria-hidden":"true"}},[s._v("#")]),s._v(" exists 和 in")]),s._v(" "),a("p",[s._v("当B表的数据集必须小于A表的数据集时，用in优于exists")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" A "),a("span",{attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id "),a("span",{attrs:{class:"token operator"}},[s._v("in")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" B"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("当A表的数据集小于B表的数据集时，用exists优于in")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" A "),a("span",{attrs:{class:"token keyword"}},[s._v("where")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("exists")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" B "),a("span",{attrs:{class:"token keyword"}},[s._v("where")]),s._v(" B"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" A"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("注意：A表与B表的字段应建立索引。")]),s._v(" "),a("h2",{attrs:{id:"exists"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#exists","aria-hidden":"true"}},[s._v("#")]),s._v(" EXISTS")]),s._v(" "),a("p",[s._v("SELECT ... FROM table WHERE EXISTS(subquery)")]),s._v(" "),a("p",[s._v("该语法可以理解为：将主查询的数据，放到子查询中做条件验证，根据验证结果（TRUE 或 FALSE）来决这【下主查询的数据结果是否得以保留")]),s._v(" "),a("h2",{attrs:{id:"提示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#提示","aria-hidden":"true"}},[s._v("#")]),s._v(" 提示")]),s._v(" "),a("ul",[a("li",[s._v("1.EXISTS（subquery）只返回TRUE或FALSE,因此子查询中的 SELECT * 也可以是SELECT 1或其它，官方说法是实际执行时会忽略SELECT 清单，因此没有区别")]),s._v(" "),a("li",[s._v("2.EXISTS子查询的实际执行过程可能经过了优化，而不是我们理解上的逐条对比，如果担忧效率问题，可进行实际检验以确定是否有效率问题。")]),s._v(" "),a("li",[s._v("3.EXISTS子查询往往也可以用条件表达式，其他子查询或者JOIN替代，何种最优需具体问题具体分析。")])])])}],!1,null,null,null);r.options.__file="18.小表驱动大表.md";t.default=r.exports}}]);