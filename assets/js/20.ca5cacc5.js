(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{192:function(s,t,a){"use strict";a.r(t);var n=a(0),r=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"_20-慢查询日志分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_20-慢查询日志分析","aria-hidden":"true"}},[s._v("#")]),s._v(" 20.慢查询日志分析")]),s._v(" "),a("ul",[a("li",[s._v("1.MySQL的慢查询日志是MySQL提供的一种日志记录，它用来记录在MySQL中响应时间超过阈值的语句，具体指运行时间超过long_query_time值的SQL,则会被记录到慢查询日志中。")]),s._v(" "),a("li",[s._v("具体指运行时间超过long_query_time值的,则会被记录到慢查询日志中。long_query_time的默认值为10，意转是运行10秒以上的语句")]),s._v(" "),a("li",[s._v("由他来查看哪些SQL超出了我们的最大忍耐时间值，比如一条SQL执行超过5秒钏，我们就算慢SQL,希望能搜集超过5秒的SQL,结合explain进行全面分析。")])]),s._v(" "),a("p",[s._v("默认情况下，MySQL数据库没有开启慢查询日志，需要我们手动来设置这个参数。")]),s._v(" "),a("p",[s._v("当然如果不是调优需要的话，一般不建议启动该参数，因为开启慢查询日志或多或少带来一定的性能影响。慢查询日志支持将日志记录写入文件。")]),s._v(" "),a("h2",{attrs:{id:"查看是否开启"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看是否开启","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看是否开启")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" VARIABLES "),a("span",{attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'%slow_query_log%'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("---------------------+---------------------------------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name       "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("Value")]),s._v("                           "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("---------------------+---------------------------------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" slow_query_log      "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("OFF")]),s._v("                             "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" slow_query_log_file "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("shinley"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("slow"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("---------------------+---------------------------------+")]),s._v("\n"),a("span",{attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])])]),a("h2",{attrs:{id:"开启"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启","aria-hidden":"true"}},[s._v("#")]),s._v(" 开启")]),s._v(" "),a("p",[s._v("只对当前数据库生效，重启后失效")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("global")]),s._v(" slow_query_log"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" affected "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" VARIABLES "),a("span",{attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'%slow_query_log%'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("---------------------+---------------------------------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name       "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("Value")]),s._v("                           "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("---------------------+---------------------------------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" slow_query_log      "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("ON")]),s._v("                              "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" slow_query_log_file "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("shinley"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("slow"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("---------------------+---------------------------------+")]),s._v("\n"),a("span",{attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])])]),a("p",[s._v("如果要永久生效，就必须修改配置文件my.cnf")]),s._v(" "),a("p",[s._v("修改my.cnf文件，[mysqld]下增加或修改参数slow_query_log和slow_query_log_file后，然后重启MySQL服务器")]),s._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("slow_query_log=1\nslow_query_log_file=/var/lib/mysql/mysql-slow.log\n\n")])])]),a("h2",{attrs:{id:"开启了慢查询日志后，什么样的sql才会记录到慢查询日志里面呢？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启了慢查询日志后，什么样的sql才会记录到慢查询日志里面呢？","aria-hidden":"true"}},[s._v("#")]),s._v(" 开启了慢查询日志后，什么样的SQL才会记录到慢查询日志里面呢？")]),s._v(" "),a("p",[s._v("这个参数是由 long_query_time控制，默认情况下long_query_time的值为10秒")]),s._v(" "),a("p",[s._v("命令：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" VARIABLES "),a("span",{attrs:{class:"token operator"}},[s._v("LIKE")]),a("span",{attrs:{class:"token string"}},[s._v("'%long_query_time%'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("-----------------+-----------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name   "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("Value")]),s._v("     "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("-----------------+-----------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" long_query_time "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("10.000000")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("-----------------+-----------+")]),s._v("\n"),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])])]),a("p",[s._v("修改时间： 修改后看不出变化，需要重新打开终端，再次查看，才能看到效果。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("global")]),s._v(" long_query_time"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token number"}},[s._v("3")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" affected "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" VARIABLES "),a("span",{attrs:{class:"token operator"}},[s._v("LIKE")]),a("span",{attrs:{class:"token string"}},[s._v("'%long_query_time%'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("-----------------+-----------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name   "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("Value")]),s._v("     "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("-----------------+-----------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" long_query_time "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("10.000000")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("-----------------+-----------+")]),s._v("\n"),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("重新打开终端查看")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),a("span",{attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'%long_query_time%'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("-----------------+----------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name   "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("Value")]),s._v("    "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("-----------------+----------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" long_query_time "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("3.000000")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("-----------------+----------+")]),s._v("\n"),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("或者直接加 global查看")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),a("span",{attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'%long_query_time%'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("-----------------+----------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name   "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("Value")]),s._v("    "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("-----------------+----------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" long_query_time "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("3.000000")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("-----------------+----------+")]),s._v("\n"),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("global")]),s._v("  variables "),a("span",{attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'%long_query_time%'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("-----------------+----------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name   "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("Value")]),s._v("    "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("-----------------+----------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" long_query_time "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0.300000")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("-----------------+----------+")]),s._v("\n"),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])])]),a("p",[s._v("可以使用命令修改，也可以在my.cnf参数里面修改。")]),s._v(" "),a("p",[s._v("如果运行时间正好等于设置的时间，并不会记录下来。只有大于设置的时间才会记录。")]),s._v(" "),a("p",[s._v("【mysqld】下配置")]),s._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("slow_query_log=1;\nslow_query_log_file=/var/lib/mysql/shinley-slow.log\nlong_query_time=3;\nlog_out_put=FILE;\n\n")])])]),a("h2",{attrs:{id:"模拟慢查询，延迟4秒"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模拟慢查询，延迟4秒","aria-hidden":"true"}},[s._v("#")]),s._v(" 模拟慢查询，延迟4秒")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("select")]),s._v(" sleep"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("4")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("----------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" sleep"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("4")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("----------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),a("span",{attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("----------+")]),s._v("\n"),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("4.00")]),s._v(" sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])])]),a("h1",{attrs:{id:"查询当前系统中有多少条慢查询记录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询当前系统中有多少条慢查询记录","aria-hidden":"true"}},[s._v("#")]),s._v(" 查询当前系统中有多少条慢查询记录")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("global")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("status")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'%slow_queries%'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("---------------+-------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("Value")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("---------------+-------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" Slow_queries  "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v("     "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("---------------+-------+")]),s._v("\n"),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("h1",{attrs:{id:"日志分析工具-mysqldumpslow"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志分析工具-mysqldumpslow","aria-hidden":"true"}},[s._v("#")]),s._v(" 日志分析工具 mysqldumpslow")]),s._v(" "),a("p",[s._v("查看帮助")]),s._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("shinley@shinley:~$ mysqldumpslow -h;\nOption h requires an argument\nERROR: bad option\n\nUsage: mysqldumpslow [ OPTS... ] [ LOGS... ]\n\nParse and summarize the MySQL slow query log. Options are\n\n  --verbose    verbose\n  --debug      debug\n  --help       write this text to standard output\n\n  -v           verbose\n  -d           debug\n  -s ORDER     what to sort by (al, at, ar, c, l, r, t), 'at' is default\n                al: average lock time\n                ar: average rows sent\n                at: average query time\n                 c: count\n                 l: lock time\n                 r: rows sent\n                 t: query time  \n  -r           reverse the sort order (largest last instead of first)\n  -t NUM       just show the top n queries\n  -a           don't abstract all numbers to N and strings to 'S'\n  -n NUM       abstract numbers with at least n digits within names\n  -g PATTERN   grep: only consider stmts that include this string\n  -h HOSTNAME  hostname of db server for *-slow.log filename (can be wildcard),\n               default is '*', i.e. match all\n  -i NAME      name of server instance (if using mysql.server startup script)\n  -l           don't subtract lock time from total time\n")])])]),a("ul",[a("li",[s._v("s: 是表示按照何种方式排序")]),s._v(" "),a("li",[s._v("c:访问次数")]),s._v(" "),a("li",[s._v("l:锁定时间")]),s._v(" "),a("li",[s._v("r:返回记录")]),s._v(" "),a("li",[s._v("t:查询时间")]),s._v(" "),a("li",[s._v("al:平均锁定时间")]),s._v(" "),a("li",[s._v("ar:平均返回记录数")]),s._v(" "),a("li",[s._v("at:平均查询时间")]),s._v(" "),a("li",[s._v("t:即为返回前面多少条数据")]),s._v(" "),a("li",[s._v("g:后面搭配一个正则匹配模式，大小写不敏感的；")])]),s._v(" "),a("h3",{attrs:{id:"得到返回记录集最多的10个sql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#得到返回记录集最多的10个sql","aria-hidden":"true"}},[s._v("#")]),s._v(" 得到返回记录集最多的10个SQL")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysqldumpslow "),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("s r "),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("t "),a("span",{attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("shinley"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("slow"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log\n")])])]),a("h3",{attrs:{id:"得到访问次数最多的10个sql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#得到访问次数最多的10个sql","aria-hidden":"true"}},[s._v("#")]),s._v(" 得到访问次数最多的10个SQL")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysqldumpslow "),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("s c "),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("t "),a("span",{attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("shinley"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("slow"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log\n\n")])])]),a("h3",{attrs:{id:"得到按照时间排序的前10条里面含有左连接的查询语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#得到按照时间排序的前10条里面含有左连接的查询语句","aria-hidden":"true"}},[s._v("#")]),s._v(" 得到按照时间排序的前10条里面含有左连接的查询语句")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysqldumpslow "),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("s t "),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("t "),a("span",{attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("g "),a("span",{attrs:{class:"token string"}},[s._v('"left join"')]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("shinley"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("slow"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log\n")])])]),a("h3",{attrs:{id:"另外建议在使用这些命令时结合-和more使用，否则有可能出现爆屏情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#另外建议在使用这些命令时结合-和more使用，否则有可能出现爆屏情况","aria-hidden":"true"}},[s._v("#")]),s._v(" 另外建议在使用这些命令时结合 | 和more使用，否则有可能出现爆屏情况")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysqldumpslow "),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("s r "),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("t "),a("span",{attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("shinley"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("slow"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log\n")])])])])}],!1,null,null,null);r.options.__file="20.慢查询日志分析.md";t.default=r.exports}}]);