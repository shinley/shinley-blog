<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2. MySQL 用户管理 | 陈新磊的读书笔记</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/assets/css/styles.f518d815.css" as="style"><link rel="preload" href="/assets/js/app.f518d815.js" as="script"><link rel="preload" href="/assets/js/19.f9c23d6f.js" as="script"><link rel="prefetch" href="/assets/js/16.a05f5c53.js"><link rel="prefetch" href="/assets/css/1.styles.5a8ea794.css"><link rel="prefetch" href="/assets/js/1.5a8ea794.js"><link rel="prefetch" href="/assets/css/2.styles.cf289c67.css"><link rel="prefetch" href="/assets/js/2.cf289c67.js"><link rel="prefetch" href="/assets/js/3.ebd152b3.js"><link rel="prefetch" href="/assets/js/4.17531713.js"><link rel="prefetch" href="/assets/js/5.af9e6587.js"><link rel="prefetch" href="/assets/js/6.fc925cca.js"><link rel="prefetch" href="/assets/js/7.603902a0.js"><link rel="prefetch" href="/assets/js/8.d2d6cb3f.js"><link rel="prefetch" href="/assets/js/9.1b044dfa.js"><link rel="prefetch" href="/assets/js/10.931c5de7.js"><link rel="prefetch" href="/assets/js/11.c02b6a22.js"><link rel="prefetch" href="/assets/js/12.905af051.js"><link rel="prefetch" href="/assets/js/13.43b353fc.js"><link rel="prefetch" href="/assets/js/14.6b313113.js"><link rel="prefetch" href="/assets/js/15.f92f208f.js"><link rel="prefetch" href="/assets/js/17.f7e63732.js"><link rel="prefetch" href="/assets/js/18.cfdb5582.js"><link rel="prefetch" href="/assets/js/20.ca5cacc5.js"><link rel="prefetch" href="/assets/js/21.b9a3f6bf.js"><link rel="prefetch" href="/assets/js/22.ad52503d.js"><link rel="prefetch" href="/assets/js/23.b50655b8.js"><link rel="prefetch" href="/assets/js/24.ae33eca4.js"><link rel="prefetch" href="/assets/js/25.35319afc.js"><link rel="prefetch" href="/assets/js/26.14cfb51c.js"><link rel="prefetch" href="/assets/js/27.6d00f7aa.js"><link rel="prefetch" href="/assets/js/28.9adb62e6.js"><link rel="prefetch" href="/assets/js/29.96b612e5.js"><link rel="prefetch" href="/assets/js/30.d16089d8.js"><link rel="prefetch" href="/assets/js/31.833984b0.js"><link rel="prefetch" href="/assets/js/32.0f873b57.js"><link rel="prefetch" href="/assets/js/33.e1a966ad.js"><link rel="prefetch" href="/assets/js/34.1e435d13.js"><link rel="prefetch" href="/assets/js/35.400e2100.js">
    <link rel="stylesheet" href="/assets/css/1.styles.5a8ea794.css"><link rel="stylesheet" href="/assets/css/2.styles.cf289c67.css"><link rel="stylesheet" href="/assets/css/styles.f518d815.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">陈新磊的读书笔记</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/python/fabric.html" class="nav-link">主页</a></div><div class="nav-item"><a href="/mongodb/" class="nav-link">MongoDB</a></div><div class="nav-item"><a href="/redis/" class="nav-link">Redis</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/python/fabric.html" class="nav-link">主页</a></div><div class="nav-item"><a href="/mongodb/" class="nav-link">MongoDB</a></div><div class="nav-item"><a href="/redis/" class="nav-link">Redis</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Python</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/python/fabric.html" class="sidebar-link">自动化部署工具Fabric</a></li><li><a href="/python/subprocess.html" class="sidebar-link">Subprocess调用shell命令</a></li><li><a href="/python/pexpect.html" class="sidebar-link">自动化交互式的命令行pexpect</a></li><li><a href="/python/crashzip.html" class="sidebar-link">暴力破解zip压缩包的密码</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>JAVA</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/java/jvm.html" class="sidebar-link">JVM性能调优</a></li><li><a href="/java/thread.html" class="sidebar-link">多线程</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>MySQL</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/mysql/1.Install-MySQL5.7.22.html" class="sidebar-link">1. MySQL 5.7.22安装</a></li><li><a href="/mysql/2.MySQL-User-Manager.html" class="active sidebar-link">2. MySQL 用户管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mysql/2.MySQL-User-Manager.html#使用mysql命令登录数据库" class="sidebar-link">使用mysql命令登录数据库</a></li><li class="sidebar-sub-header"><a href="/mysql/2.MySQL-User-Manager.html#新建普通用户" class="sidebar-link">新建普通用户</a></li><li class="sidebar-sub-header"><a href="/mysql/2.MySQL-User-Manager.html#删除普通用户" class="sidebar-link">删除普通用户</a></li><li class="sidebar-sub-header"><a href="/mysql/2.MySQL-User-Manager.html#root用户修改自已的密码" class="sidebar-link">root用户修改自已的密码</a></li><li class="sidebar-sub-header"><a href="/mysql/2.MySQL-User-Manager.html#root用户修改普通用户密码" class="sidebar-link">root用户修改普通用户密码</a></li><li class="sidebar-sub-header"><a href="/mysql/2.MySQL-User-Manager.html#root用户密码丢失解决办法" class="sidebar-link">root用户密码丢失解决办法</a></li><li class="sidebar-sub-header"><a href="/mysql/2.MySQL-User-Manager.html#配置远程连接" class="sidebar-link">配置远程连接</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mysql/2.MySQL-User-Manager.html#一、修改-etc-mysql-my-conf" class="sidebar-link">一、修改/etc/mysql/my.conf</a></li><li class="sidebar-sub-header"><a href="/mysql/2.MySQL-User-Manager.html#二、为需要远程登录的用户赋予权限" class="sidebar-link">二、为需要远程登录的用户赋予权限</a></li></ul></li></ul></li><li><a href="/mysql/3.MySQL备份与还原.html" class="sidebar-link">3.MySql备份与还原</a></li><li><a href="/mysql/4.七种连接方式.html" class="sidebar-link">4.七种连接方式</a></li><li><a href="/mysql/5.MySQL索引01.html" class="sidebar-link">5.MySQL索引（一）</a></li><li><a href="/mysql/6.MySQL索引02.html" class="sidebar-link">6.MySQL索引(二)</a></li><li><a href="/mysql/7.单表优化案例.html" class="sidebar-link">7.单表优化案例</a></li><li><a href="/mysql/8.两表和三表优化案例.html" class="sidebar-link">8. 两表和三表优化案例</a></li><li><a href="/mysql/9.索引优化01.html" class="sidebar-link">9.索引优化(一)</a></li><li><a href="/mysql/10.索引优化02.html" class="sidebar-link">10.索引优化(二)</a></li><li><a href="/mysql/11.索引优化03.html" class="sidebar-link">11. 索引优化(三)</a></li><li><a href="/mysql/12.索引优化04.html" class="sidebar-link">12. 索引优化(四)</a></li><li><a href="/mysql/13.索引优化05.html" class="sidebar-link">13.索引优化(五)</a></li><li><a href="/mysql/14.索引优化06.html" class="sidebar-link">14. 索引优化(六)</a></li><li><a href="/mysql/15.索引优化07.html" class="sidebar-link">15.索引优化(七)</a></li><li><a href="/mysql/16.索引优化08.html" class="sidebar-link">16.索引优化(八)</a></li><li><a href="/mysql/17.索引面试题.html" class="sidebar-link">17.索引面试题</a></li><li><a href="/mysql/18.小表驱动大表.html" class="sidebar-link">18.小表驱动大表</a></li><li><a href="/mysql/19.order by关键字优化.html" class="sidebar-link">19.order by关键字优化</a></li><li><a href="/mysql/20.慢查询日志分析.html" class="sidebar-link">20.慢查询日志分析</a></li><li><a href="/mysql/21.批量数据脚本.html" class="sidebar-link">21.批量数据脚本</a></li><li><a href="/mysql/22.Show Profile.html" class="sidebar-link">22.Show Profile</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="_2-mysql-用户管理"><a href="#_2-mysql-用户管理" aria-hidden="true" class="header-anchor">#</a> 2. MySQL 用户管理</h1> <h2 id="使用mysql命令登录数据库"><a href="#使用mysql命令登录数据库" aria-hidden="true" class="header-anchor">#</a> 使用mysql命令登录数据库</h2> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql <span class="token operator">-</span>h localhost <span class="token operator">-</span>uroot <span class="token operator">-</span>p
</code></pre></div><ul><li>-h 主机名</li> <li>-u 用户名</li> <li>-p 密码   ，密码和-p之间不能有空格</li> <li>-P(大写) 端口号，不指定时默认为3306</li> <li>-e 执行的SQL语句</li></ul> <h2 id="新建普通用户"><a href="#新建普通用户" aria-hidden="true" class="header-anchor">#</a> 新建普通用户</h2> <pre><code>两种方式，一是使用create user或grant语句，另一种是直接操作mysql授权表
</code></pre> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> user_speification <span class="token punctuation">[</span><span class="token punctuation">,</span>user_specification<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    user_specification:
    <span class="token keyword">user</span><span class="token variable">@host</span>
    <span class="token punctuation">[</span>
        IDENTIFIED <span class="token keyword">BY</span> <span class="token punctuation">[</span>PASSWORD<span class="token punctuation">]</span> <span class="token string">'password'</span>
        ｜IDENTIFIED <span class="token keyword">WITH</span> auth_plugin <span class="token punctuation">[</span><span class="token keyword">AS</span> <span class="token string">'auth_string'</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
</code></pre></div><p>例：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> ‘jeffrey’@'localhost<span class="token string">' IDENTIFIED BY '</span>mypass'
</code></pre></div><p>为了避免指定明文密码，如果知道密码的散列值 ，可以通过PASSWORD关键字使用密码的哈希设置密码
密码的哈希值可以使用password() 函数获取：
如：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> password<span class="token punctuation">(</span><span class="token string">'mypass'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>使用GRANT语句创建新用户，同时也可以赋权限</p> <div class="language-sql extra-class"><pre class="language-sql"><code>    <span class="token keyword">GRANT</span> <span class="token keyword">privileges</span> <span class="token keyword">ON</span> db<span class="token punctuation">.</span><span class="token keyword">table</span>
    <span class="token keyword">TO</span> <span class="token keyword">user</span><span class="token variable">@host</span> <span class="token punctuation">[</span>IDENTIFIED <span class="token keyword">BY</span> ‘password’<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token keyword">user</span><span class="token punctuation">[</span>INDENTIFIED <span class="token keyword">BY</span> <span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span><span class="token punctuation">]</span>
</code></pre></div><p>例：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MySQL<span class="token operator">&gt;</span><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span><span class="token punctuation">,</span><span class="token keyword">UPDATE</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'testUser@localhost'</span>
     <span class="token operator">&gt;</span>IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'testpwd'</span>
</code></pre></div><p>执行成功后，验证testUser的权限</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MySQL<span class="token operator">&gt;</span><span class="token keyword">SELECT</span> Host，<span class="token keyword">User</span><span class="token punctuation">,</span>Select_priv<span class="token punctuation">,</span>Update_priv <span class="token keyword">FROM</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span> <span class="token keyword">where</span> <span class="token keyword">user</span><span class="token operator">=</span><span class="token string">'testUser'</span>
</code></pre></div><p>User表中的user和host字段区分大小写，在查询的时候要指定正确的用户名 或主机名</p> <h2 id="删除普通用户"><a href="#删除普通用户" aria-hidden="true" class="header-anchor">#</a> 删除普通用户</h2> <p>使用DROP USER删除用户</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">USER</span> <span class="token keyword">user</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token keyword">user</span><span class="token punctuation">]</span>
</code></pre></div><p>例：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">USER</span> ‘<span class="token keyword">user</span><span class="token variable">@localhost</span>’
</code></pre></div><h2 id="root用户修改自已的密码"><a href="#root用户修改自已的密码" aria-hidden="true" class="header-anchor">#</a> root用户修改自已的密码</h2> <div class="language-sql extra-class"><pre class="language-sql"><code>mysqladmin <span class="token operator">-</span>u username <span class="token operator">-</span>h localhost <span class="token operator">-</span>p password <span class="token string">&quot;newpwd&quot;</span>
</code></pre></div><p>使用SET语句修改root用户的密码（普通用户也可以修改自已的密码）</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> PASSWORD<span class="token operator">=</span>PASSWORD<span class="token punctuation">(</span><span class="token string">&quot;rootpwd&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="root用户修改普通用户密码"><a href="#root用户修改普通用户密码" aria-hidden="true" class="header-anchor">#</a> root用户修改普通用户密码</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> PASSWORD <span class="token keyword">FOR</span> <span class="token string">'user'</span>@'host<span class="token string">'=PASSWORD('</span>somepassword'<span class="token punctuation">)</span>
</code></pre></div><h2 id="root用户密码丢失解决办法"><a href="#root用户密码丢失解决办法" aria-hidden="true" class="header-anchor">#</a> root用户密码丢失解决办法</h2> <p>使用 --skip-grant-tables选项启动MySQL服务</p> <p>windows操作系统中，使用mysqld或mysqld-nt来启动MySQL服务进程</p> <p>mysqld命令如下：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysqld <span class="token comment">--skip-grant-tables</span>
</code></pre></div><p>myslqd-nt命令如下：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysqld<span class="token operator">-</span>nt  <span class="token comment">--skip-grant-tables</span>
</code></pre></div><p>Linux操作系统中，使用mysqld_safe来启动MySQL服务，
也可以使用/etc/init.d/mysql命令来启动MySQL服务。</p> <p>mysqld_safe 命令如下</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysqld_safe <span class="token comment">--skip-grant-tables user=mysql</span>
</code></pre></div><p>/etc/init.d/mysql命令如下</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">/</span>etc<span class="token operator">/</span>init<span class="token punctuation">.</span>d<span class="token operator">/</span>mysql <span class="token keyword">start</span><span class="token operator">-</span>mysqld <span class="token comment">--skip-grant-tables</span>
</code></pre></div><p>启动MySQL服务后，就可以使用root用户登录了。</p> <p>修改密码后，要刷新权限 ，新密码才会生效</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span>FLUSH <span class="token keyword">PRIVILEGES</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="配置远程连接"><a href="#配置远程连接" aria-hidden="true" class="header-anchor">#</a> 配置远程连接</h2> <p>默认情况下，mysql只允许本地登录，如果要开启远程连接，则需要修改/etc/mysql/my.conf文件。</p> <h3 id="一、修改-etc-mysql-my-conf"><a href="#一、修改-etc-mysql-my-conf" aria-hidden="true" class="header-anchor">#</a> 一、修改/etc/mysql/my.conf</h3> <p>找到bind-address = 127.0.0.1这一行
改为bind-address = 0.0.0.0即可</p> <h3 id="二、为需要远程登录的用户赋予权限"><a href="#二、为需要远程登录的用户赋予权限" aria-hidden="true" class="header-anchor">#</a> 二、为需要远程登录的用户赋予权限</h3> <ol><li>新建用户远程连接mysql数据库</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">on</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> admin@'<span class="token operator">%</span><span class="token string">' identified by '</span><span class="token number">123456</span>' <span class="token keyword">with</span> <span class="token keyword">grant</span> <span class="token keyword">option</span><span class="token punctuation">;</span> 
flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
</code></pre></div><p>允许任何ip地址(%表示允许任何ip地址)的电脑用admin帐户和密码(123456)来访问这个mysql server。
注意admin账户不一定要存在。</p> <ol start="2"><li>支持root用户允许远程连接mysql数据库</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span> <span class="token keyword">on</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'root'</span>@'<span class="token operator">%</span><span class="token string">' identified by '</span><span class="token number">123456</span>' <span class="token keyword">with</span> <span class="token keyword">grant</span> <span class="token keyword">option</span><span class="token punctuation">;</span>
flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
</code></pre></div><p>三、查看系统用户</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">use</span> mysql<span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">,</span> host <span class="token keyword">from</span> <span class="token keyword">user</span><span class="token punctuation">;</span>

</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/mysql/1.Install-MySQL5.7.22.html" class="prev">
          1. MySQL 5.7.22安装
        </a></span> <span class="next"><a href="/mysql/3.MySQL备份与还原.html">
          3.MySql备份与还原
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/19.f9c23d6f.js" defer></script><script src="/assets/js/app.f518d815.js" defer></script>
  </body>
</html>
