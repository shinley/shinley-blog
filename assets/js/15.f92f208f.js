(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{195:function(s,t,a){"use strict";a.r(t);var n=a(0),r=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"_16-索引优化-八"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_16-索引优化-八","aria-hidden":"true"}},[s._v("#")]),s._v(" 16.索引优化(八)")]),s._v(" "),a("h2",{attrs:{id:"字符串不加单引号索引会失效"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#字符串不加单引号索引会失效","aria-hidden":"true"}},[s._v("#")]),s._v(" 字符串不加单引号索引会失效")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" staffs "),a("span",{attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token number"}},[s._v("2000")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("----+------+-----+-----+---------------------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" id "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" name "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" age "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" pos "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" add_time            "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("----+------+-----+-----+---------------------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("2000")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{attrs:{class:"token number"}},[s._v("23")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" dev "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("2017")]),a("span",{attrs:{class:"token operator"}},[s._v("-")]),a("span",{attrs:{class:"token number"}},[s._v("05")]),a("span",{attrs:{class:"token operator"}},[s._v("-")]),a("span",{attrs:{class:"token number"}},[s._v("08")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("20")]),s._v(":"),a("span",{attrs:{class:"token number"}},[s._v("48")]),s._v(":"),a("span",{attrs:{class:"token number"}},[s._v("58")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("----+------+-----+-----+---------------------+")]),s._v("\n"),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("set")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" warning "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n")])])]),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" staffs "),a("span",{attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("july"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nERROR "),a("span",{attrs:{class:"token number"}},[s._v("1054")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("42")]),s._v("S22"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": Unknown "),a("span",{attrs:{class:"token keyword"}},[s._v("column")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'july'")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'where clause'")]),s._v("\n\n")])])]),a("p",[s._v("当name为数字时，不加单引号，内部进行了类型转换，所以导致索引失效。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" staffs "),a("span",{attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token number"}},[s._v("2000")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" id "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" select_type "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("table")]),s._v("  "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" partitions "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("type")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" possible_keys         "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("key")]),s._v("  "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" key_len "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" ref  "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" filtered "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" Extra       "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("SIMPLE")]),s._v("      "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" staffs "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("       "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("ALL")]),s._v("  "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" idx_staffs_nameAgePos "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("    "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),a("span",{attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),a("span",{attrs:{class:"token number"}},[s._v("33.33")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("Using")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("where")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+")]),s._v("\n"),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("set")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("warnings")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("h2",{attrs:{id:"少用or-用它来连接时会索引失效"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#少用or-用它来连接时会索引失效","aria-hidden":"true"}},[s._v("#")]),s._v(" 少用or, 用它来连接时会索引失效")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" staffs "),a("span",{attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token string"}},[s._v("'july'")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("or")]),s._v(" name"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token string"}},[s._v("'zs'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" id "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" select_type "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("table")]),s._v("  "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" partitions "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("type")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" possible_keys         "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("key")]),s._v("  "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" key_len "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" ref  "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" filtered "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" Extra       "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("SIMPLE")]),s._v("      "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" staffs "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("       "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("ALL")]),s._v("  "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" idx_staffs_nameAgePos "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("    "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),a("span",{attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),a("span",{attrs:{class:"token number"}},[s._v("66.67")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("Using")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("where")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("+")]),a("span",{attrs:{class:"token comment"}},[s._v("----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+")]),s._v("\n"),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("set")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" warning "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])])]),a("h2",{attrs:{id:"口诀总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#口诀总结","aria-hidden":"true"}},[s._v("#")]),s._v(" 口诀总结")]),s._v(" "),a("ul",[a("li",[s._v("1.带头大哥不能死")]),s._v(" "),a("li",[s._v("2.中间兄弟不能断，永远要符合左前缀法则")]),s._v(" "),a("li",[s._v("3.索引列上无计算")]),s._v(" "),a("li",[s._v("4.like 百分加右边")]),s._v(" "),a("li",[s._v("5.范围后面全失效")]),s._v(" "),a("li",[s._v("6.字符串里有引号")])]),s._v(" "),a("p",[s._v("题目总结：")]),s._v(" "),a("p",[s._v("假设index(a,b,c)")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("where语句")]),s._v(" "),a("th",[s._v("索引是否被使用")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("where a = 3")]),s._v(" "),a("td",[s._v("Y, 使用到a")])]),s._v(" "),a("tr",[a("td",[s._v("where a = 3 and b = 5")]),s._v(" "),a("td",[s._v("Y, 使用到a,b")])]),s._v(" "),a("tr",[a("td",[s._v("where a = 3 and b = 5 and c = 4")]),s._v(" "),a("td",[s._v("Y, 使用到 a, b, c")])]),s._v(" "),a("tr",[a("td",[s._v("where a = 3 或者 where b = 3 and c = 4 或者 c = 4")]),s._v(" "),a("td",[s._v("N")])]),s._v(" "),a("tr",[a("td",[s._v("where a = 3 and c = 5")]),s._v(" "),a("td",[s._v("使用到a, 但是c不可以，b中间断了")])]),s._v(" "),a("tr",[a("td",[s._v("where a = 3 and b > 4 and c = 5")]),s._v(" "),a("td",[s._v("使用到a和b,c不能被使用，由于在范围之后")])]),s._v(" "),a("tr",[a("td",[s._v("where a = 3 and b like 'kk%' and c = 5")]),s._v(" "),a("td",[s._v("Y, 使用到a,b,c")])]),s._v(" "),a("tr",[a("td",[s._v("where a = 3 and b like '%kk' and c = 5")]),s._v(" "),a("td",[s._v("Y,只能用到a")])]),s._v(" "),a("tr",[a("td",[s._v("where a = 3 and b like '%kk%' and c = 5")]),s._v(" "),a("td",[s._v("Y,只能用到a")])]),s._v(" "),a("tr",[a("td",[s._v("where a = 3 and b like 'K%kk%' and c = 5")]),s._v(" "),a("td",[s._v("Y,使用到a,b,c")])])])]),s._v(" "),a("h2",{attrs:{id:"优化总结口诀"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化总结口诀","aria-hidden":"true"}},[s._v("#")]),s._v(" [优化总结口诀]")]),s._v(" "),a("ul",[a("li",[s._v("全值匹配我最受，最左前缀要遵守；")]),s._v(" "),a("li",[s._v("带头大哥不能死，中间兄弟不能断;")]),s._v(" "),a("li",[s._v("索引列上少计算，范围之后全失效；")]),s._v(" "),a("li",[s._v("LIKE百分写最右，覆盖索引不写星")]),s._v(" "),a("li",[s._v("不等空值还有or,索引失效要少用;")]),s._v(" "),a("li",[s._v("VAR引号不可丢，SQL高级也不难！")])])])}],!1,null,null,null);r.options.__file="16.索引优化08.md";t.default=r.exports}}]);